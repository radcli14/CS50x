{% extends "layout.html" %}

{% block title %}
    Lists
{% endblock %}

{% block main %}

    <div class="d-flex flex-column align-items-center"> 
        <h1>Lists for {{ data.username }}</h1>

        <h3>Trips</h3>

        <!-- The button toolbar at the top, with previous, next, and new buttons -->
        <div class="btn-toolbar mb-3" role="toolbar" aria-label="Toolbar with button groups">
            <div class="btn-group me-2" role="group" aria-label="Navigation group">
                <button type="button" class="btn btn-secondary" id="prev-btn" disabled>Previous</button>
                <button type="button" class="btn btn-secondary" id="next-btn" disabled>Next</button>
            </div>
            <div class="btn-group" role="group" aria-label="New List">
                <button type="button" class="btn btn-primary">New List</button>
            </div>
        </div>

        <!-- The trip card, making up the majority of the screen content -->
        <div id="trip-cards-container" class="w-100"> 
            {% for trip in trips %}
                <div class="card trip-card w-100 mb-3 shadow-lg border-0" style="max-width: 600px; margin: 0 auto;">
                    <div class="card-body">

                        <h5 class="card-title">
                            <input type="text" value="{{ trip.date }}" class="trip-date-display text-center" readonly style="border: none; background: transparent; font-weight: bold; width: auto;">
                        </h5>

                        <!-- The dropdown menu to select the store from the list of stores -->
                        <div class="store-data d-none">{{ stores | tojson }}</div>

                        <select class="form-select mb-2 d-inline store-name-select" data-original-name="{{ trip.name }}" style="max-width: 200px; width: auto;">
                            <option value="" disabled>Select a Store</option>
                            
                            {% for store in stores %}
                                <option value="{{ store.name }}" 
                                        data-store-id="{{ store.id }}" 
                                        data-address="{{ store.address }}"
                                        {% if store.name == trip.name %}selected{% endif %}>
                                    {{ store.name }}
                                </option>
                            {% endfor %}

                            {% if trip.name not in stores | map(attribute='name') | list %}
                                <option value="{{ trip.name }}" selected>{{ trip.name }} (Unlisted)</option>
                            {% endif %}
                        </select>

                        <h6 class="card-subtitle mb-2 text-muted fw-light current-trip-address">{{ trip.address }}</h6>
                        
                        <!-- Summary of the trip (editable) -->
                        <textarea class="form-control trip-summary-input mb-2 text-center">{{ trip.summary }}</textarea>

                        <!-- The list of all items on the shopping list -->
                        <table class="table trip-item-table">
                            <thead>
                                <th></th>
                                <th>Item</th>
                                <th>Quantity</th>
                                <th></th>
                            </thead>
                            <tbody>
                                {% for item in trip.Lists %}
                                    <tr data-list-item-id="{{ item.id }}" data-item-id="{{ item.item_id }}">
                                        <td>
                                            <button type="button" class="btn btn-outline-success btn-sm check-item-btn">&#10003;</button>
                                        </td>
                                        <td>
                                            <input type="text" class="form-control item-name-input" value="{{ item.name }}">
                                        </td>
                                        <td>
                                            <input type="number" class="form-control item-quantity-input" value="{{ item.quantity }}" min="1">
                                        </td>
                                        <td>
                                            <button type="button" class="btn btn-outline-danger btn-sm delete-item-btn">&times;</button>
                                        </td>
                                    </tr>
                                {% endfor %}

                                <!-- A row at the bottom that lets the user enter a new item -->
                                <tr class="new-item-row">
                                    <td></td>
                                    <td><input type="text" class="form-control new-item-name" placeholder="New Item"></td>
                                    <td><input type="number" class="form-control new-item-quantity" value="1" min="1"></td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- A save button that is visible if data has been modified -->
                    <div class="card-footer text-center d-none save-button-container">
                        <button type="button" class="btn btn-primary save-list-btn" data-trip-id="{{ trip.id }}">
                            Save Changes
                        </button>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <script src="{{ url_for('static', filename='lists.js') }}"></script>

{% endblock %}